<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Map Test - Minimal</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { margin: 5px 0; padding: 5px; background: #f0f0f0; }
        .error { background: #ffe6e6; }
        .success { background: #e6ffe6; }
    </style>
</head>
<body>
    <h1>üß™ Import Map Behavior Test</h1>
    <div id="logs"></div>

    <!-- Test 1: Standard ESM.sh import map -->
    <script type="importmap" id="importmap1">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom": "https://esm.sh/react-dom@19.0.0",
        "react/jsx-runtime": "https://esm.sh/react@19.0.0/jsx-runtime",
        "react/jsx-dev-runtime": "https://esm.sh/react@19.0.0/jsx-dev-runtime",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client"
      }
    }
    </script>

    <script type="module">
        const logsDiv = document.getElementById('logs');
        
        function log(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = message;
            logsDiv.appendChild(div);
            console.log(message);
        }

        // Monitor all network requests
        const requests = [];
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            requests.push(args[0]);
            log(`üåê FETCH: ${args[0]}`);
            return originalFetch.apply(this, args);
        };

        async function testImportMap() {
            try {
                log('üöÄ Testing import map behavior...', 'success');
                
                // Test each import individually
                log('\n1Ô∏è‚É£ Testing React import...');
                const React = await import('react');
                log(`‚úÖ React loaded: ${React.version}`);
                
                log('\n2Ô∏è‚É£ Testing React DOM import...');
                const ReactDOM = await import('react-dom');
                log(`‚úÖ ReactDOM loaded`);
                
                log('\n3Ô∏è‚É£ Testing JSX Runtime import...');
                const JSXRuntime = await import('react/jsx-runtime');
                log(`‚úÖ JSX Runtime loaded`);
                
                log('\n4Ô∏è‚É£ Testing React DOM Client import...');
                const ReactDOMClient = await import('react-dom/client');
                log(`‚úÖ React DOM Client loaded`);
                
                // Check network requests
                log('\nüìä Network Requests Summary:');
                const uniqueRequests = [...new Set(requests)];
                log(`Total requests: ${requests.length}`);
                log(`Unique requests: ${uniqueRequests.length}`);
                
                uniqueRequests.forEach((req, i) => {
                    log(`  ${i + 1}. ${req}`);
                });
                
                if (requests.length > uniqueRequests.length) {
                    log(`‚ö†Ô∏è Found ${requests.length - uniqueRequests.length} duplicate requests`, 'error');
                } else {
                    log(`‚úÖ No duplicate requests`, 'success');
                }
                
                // Test same React instance
                const React2 = await import('react');
                const sameInstance = React === React2;
                log(`üîç Same React instance check: ${sameInstance ? '‚úÖ PASS' : '‚ùå FAIL'}`, sameInstance ? 'success' : 'error');
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        testImportMap();
    </script>
</body>
</html>
